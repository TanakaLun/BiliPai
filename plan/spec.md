# 视频播放优化规格说明书

## 项目概述

BiliPai 用户反馈视频播放存在以下问题：

1. **播放缓慢** - 视频加载时间过长
2. **播放地址丢失** - 偶发性无法获取视频播放 URL
3. **清晰度切换失败** - 无法正常切换视频画质

## 用户故事

### US-01: 快速播放
>
> 作为用户，我希望点击视频后能够快速开始播放，减少等待时间。

**验收标准**:

- 视频从点击到开始播放时间 < 3 秒（良好网络环境）
- 重复播放同一视频时应使用缓存，< 1 秒

### US-02: 可靠播放
>
> 作为用户，我希望每次都能成功播放视频，不会遇到"找不到播放地址"的错误。

**验收标准**:

- 播放成功率 > 99%
- 临时错误自动重试并恢复
- 永久错误显示明确的原因和建议

### US-03: 流畅切换清晰度
>
> 作为用户，我希望能够随时切换视频清晰度，且切换后保持播放进度。

**验收标准**:

- 切换清晰度后从当前进度继续播放
- 如果请求的清晰度不可用，自动降级到可用最高画质
- 显示实际播放的清晰度信息

## 成功标准

| 指标 | 当前状态 | 目标 |
|------|----------|------|
| 首次加载时间 | ~5s | < 3s |
| 播放成功率 | ~95% | > 99% |
| 清晰度切换成功率 | ~80% | > 95% |

## 约束条件

- 必须兼容现有的 DASH 格式视频流处理
- 必须保持与 B 站 WBI 签名机制的兼容性
- 必须复用现有的 ExoPlayer 和 MiniPlayerManager 架构
- 缓存机制不应消耗过多内存（播放 URL 缓存上限 50 条）
